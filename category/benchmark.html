<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Haypo blog 2 - benchmark</title>
        <link rel="stylesheet" href="https://haypo.github.io/theme/css/main.css" />
        <link href="https://haypo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Haypo blog 2 Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://haypo.github.io/">Haypo blog 2 </a></h1>
                <nav><ul>
                    <li class="active"><a href="https://haypo.github.io/category/benchmark.html">benchmark</a></li>
                    <li><a href="https://haypo.github.io/category/python.html">python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://haypo.github.io/journey-to-stable-benchmark-cpu.html">My journey to stable benchmark, part 4 (CPU)</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-06-17T00:00:00+02:00">
                Published: ven. 17 juin 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://haypo.github.io/author/victor-stinner.html">Victor Stinner</a>
        </address>
<p>In <a href="https://haypo.github.io/category/benchmark.html">benchmark</a>.</p>
<p>tags: <a href="https://haypo.github.io/tag/optimization.html">optimization</a> <a href="https://haypo.github.io/tag/benchmark.html">benchmark</a> </p>
</footer><!-- /.post-info --><div class="section" id="a-bit-of-history-cpu-power-consumption">
<h2>A bit of history, CPU power consumption</h2>
<p>Near 2010, the <a class="reference external" href="https://en.wikipedia.org/wiki/Moore's_law">Moore's Law</a>
started to slow down. The CPU frequency is around 3 GHz since 5 years. The
number of transitors of the Intel i7 6700K is 1.75 B. In 2002, the process
used 130 nm. 2010 : 32 nm. 2015 : 14 nm.</p>
<p>In 2016, Intel CPU vendor stopped to only be focused on pure performances. The
market of desktop PCs is decreasing, today computers are small and have no more
power cable, but a battery. If we exagerate, the power consumption matters more
than performance. It would be hard to sell a smartphone which requires to be
plugged to a power cable more frequently than every nights: one day is still
strict minimum for the autonomy.</p>
<p>ARM CPUs are commonly used in smartphones, tablets and other kinds of
&quot;embedded&quot; devices. Intel developped technologies to reduce the power
consumption to not loose markets, starting with laptops. It started with
<a class="reference external" href="https://en.wikipedia.org/wiki/SpeedStep">SpeedStep</a> in 2005. Later Intel
introduced <a class="reference external" href="https://en.wikipedia.org/wiki/Intel_Turbo_Boost">Turbo Boost</a> in
2008. With the latest generation, Skylake now runs the power
management directly in the CPU.</p>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Thermal_design_power">Thermal design power (TDP)</a> matters!</p>
</div>
<div class="section" id="impact-of-power-consumption-on-benchmarks">
<h2>Impact of power consumption on benchmarks</h2>
<p>In short, the speed of today Intel CPUs is no more constant. It changes a lot.
It can change multiple times per minute depend many factors.</p>
<p>The Turbo Mode makes the CPU faster if the CPU temperature is lower than
a threshold. The Turbo Mode can be detected with a different CPU speed, the
difference can be a single MHz.</p>
<p>The result of a benchmark with and without Turbo Mode is huge.</p>
<p>Linux uses a power manager to change dynamically the speed of the CPU. The
default governor is usually &quot;powersave&quot;:</p>
<pre class="literal-block">
$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
powersave
</pre>
<p>See the driver:</p>
<pre class="literal-block">
$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_driver
intel_pstate
</pre>
<p>Other driver: acpi_xxx.</p>
<p>Available governors:</p>
<pre class="literal-block">
$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
performance powersave
</pre>
<p>Changing the CPU speed takes a few milliseconds. The performance governor
tries to limit the number of speed changes, whereas the powersave governor
tries to reduce the power consumption and so tries to use the lowest
CPU speed, without killing performances.</p>
</div>
<div class="section" id="cpu-turbo-boost">
<h2>CPU Turbo Boost</h2>
<p>If your system is using the intel_pstate frequency scaling driver:</p>
<pre class="literal-block">
$ cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_driver
intel_pstate
...
intel_pstate
</pre>
<p>Then you can inquire as to the turbo enabled or disabled status:</p>
<pre class="literal-block">
$ cat /sys/devices/system/cpu/intel_pstate/no_turbo
0
</pre>
<p>Check if Turbo Boost is enabled:</p>
<pre class="literal-block">
sudo rdmsr -f 38:38 0x1a0
</pre>
<ul class="simple">
<li><tt class="docutils literal">1</tt> means disabled (no turbo)</li>
<li><tt class="docutils literal">0</tt> means enabled</li>
</ul>
<p>Use the <tt class="docutils literal">wrmsr</tt> to set the Turbo Boost, or go into your BIOS/EFI.</p>
<p>Fedora: <tt class="docutils literal">dnf install <span class="pre">-u</span> <span class="pre">msr-tools</span></tt>.</p>
<p>cpuinfo:</p>
<pre class="literal-block">
$ cpupower frequency-info
analyzing CPU 0:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency: 0.97 ms.
  hardware limits: 1.20 GHz - 3.60 GHz
  available cpufreq governors: performance, powersave
  current policy: frequency should be within 1.20 GHz and 3.60 GHz.
                  The governor &quot;powersave&quot; may decide which speed to use
                  within this range.
  current CPU frequency is 1.35 GHz.
  boost state support:
    Supported: yes
    Active: yes
    25500 MHz max turbo 4 active cores
    25500 MHz max turbo 3 active cores
    25500 MHz max turbo 2 active cores
    25500 MHz max turbo 1 active cores
</pre>
</div>
<div class="section" id="linux">
<h2>Linux</h2>
<ul class="simple">
<li>Linux documentation<ul>
<li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt">Linux CPUFreq: CPUFreq Governors</a></li>
<li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/user-guide.txt">Linux CPUFreq User Guide</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="intel-power-states">
<h2>Intel power states</h2>
<p><a class="reference external" href="https://software.intel.com/en-us/articles/power-management-states-p-states-c-states-and-package-c-states">Power Management States: P-States, C-States, and Package C-States</a>.</p>
<p>C0...C6 states:</p>
<ul class="simple">
<li>C0: CPU fully turned on</li>
<li>C6: Deep Power Down</li>
<li><a class="reference external" href="http://www.hardwaresecrets.com/everything-you-need-to-know-about-the-cpu-c-states-power-saving-modes/">Everything You Need to Know About the CPU C-States Power Saving Modes</a></li>
</ul>
</div>
<div class="section" id="hyperthreading">
<h2>HyperThreading</h2>
<p>xxx</p>
</div>
                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://haypo.github.io/perf-visualize-system-noise-with-cpu-isolation.html" rel="bookmark"
                           title="Permalink to Visualize the system noise using perf and CPU isolation">Visualize the system noise using perf and CPU isolation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-06-16T13:30:00+02:00">
                Published: jeu. 16 juin 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://haypo.github.io/author/victor-stinner.html">Victor Stinner</a>
        </address>
<p>In <a href="https://haypo.github.io/category/benchmark.html">benchmark</a>.</p>
<p>tags: <a href="https://haypo.github.io/tag/benchmark.html">benchmark</a> </p>
</footer><!-- /.post-info -->                <p>I developed a new <a class="reference external" href="http://perf.readthedocs.io/">perf module</a> designed to run
stable benchmarks, give fine control on benchmark parameters and compute
statistics on results. With such tool, it becomes simple to <em>visualize</em>
sources of noise. The CPU isolation will be used to visualize the system noise.
Running a benchmark on isolated CPUs ...</p>
                <a class="readmore" href="https://haypo.github.io/perf-visualize-system-noise-with-cpu-isolation.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://haypo.github.io/journey-to-stable-benchmark-average.html" rel="bookmark"
                           title="Permalink to My journey to stable benchmark, part 3 (average)">My journey to stable benchmark, part 3 (average)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-05-23T23:00:00+02:00">
                Published: lun. 23 mai 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://haypo.github.io/author/victor-stinner.html">Victor Stinner</a>
        </address>
<p>In <a href="https://haypo.github.io/category/benchmark.html">benchmark</a>.</p>
<p>tags: <a href="https://haypo.github.io/tag/optimization.html">optimization</a> <a href="https://haypo.github.io/tag/benchmark.html">benchmark</a> </p>
</footer><!-- /.post-info -->                <p class="first last">My journey to stable benchmark, part 3 (average)</p>

                <a class="readmore" href="https://haypo.github.io/journey-to-stable-benchmark-average.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://haypo.github.io/journey-to-stable-benchmark-deadcode.html" rel="bookmark"
                           title="Permalink to My journey to stable benchmark, part 2 (deadcode)">My journey to stable benchmark, part 2 (deadcode)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-05-22T22:00:00+02:00">
                Published: dim. 22 mai 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://haypo.github.io/author/victor-stinner.html">Victor Stinner</a>
        </address>
<p>In <a href="https://haypo.github.io/category/benchmark.html">benchmark</a>.</p>
<p>tags: <a href="https://haypo.github.io/tag/optimization.html">optimization</a> <a href="https://haypo.github.io/tag/benchmark.html">benchmark</a> </p>
</footer><!-- /.post-info -->                <p class="first last">My journey to stable benchmark, part 2 (deadcode)</p>

                <a class="readmore" href="https://haypo.github.io/journey-to-stable-benchmark-deadcode.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://haypo.github.io/journey-to-stable-benchmark-system.html" rel="bookmark"
                           title="Permalink to My journey to stable benchmark, part 1 (system)">My journey to stable benchmark, part 1 (system)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-05-21T16:50:00+02:00">
                Published: sam. 21 mai 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://haypo.github.io/author/victor-stinner.html">Victor Stinner</a>
        </address>
<p>In <a href="https://haypo.github.io/category/benchmark.html">benchmark</a>.</p>
<p>tags: <a href="https://haypo.github.io/tag/optimization.html">optimization</a> <a href="https://haypo.github.io/tag/benchmark.html">benchmark</a> </p>
</footer><!-- /.post-info -->                <p class="first last">My journey to stable benchmark, part 1</p>

                <a class="readmore" href="https://haypo.github.io/journey-to-stable-benchmark-system.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://haypo-notes.readthedocs.org/">Haypo's Notes</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://haypo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/VictorStinner">Follow @VictorStinner on Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>